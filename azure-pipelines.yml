trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

steps:

- task: NuGetCommand@2
  displayName: 'Install GitVersion'
  inputs:
    command: custom
    arguments: install GitVersion.CommandLine -Version 4.0.0 -OutputDirectory $(Build.BinariesDirectory)/tools -ExcludeVersion

- script: sudo apt-get install libcurl3
  displayName: 'Install libcurl3'

- script: mono $(Build.BinariesDirectory)/tools/GitVersion.CommandLine/tools/GitVersion.exe /output buildserver /nofetch
  displayName: 'Run GitVersion'

- script: dotnet build ./src/AzureMapsControl.Components/AzureMapsControl.Components.csproj -c Release /p:Version='$(GitVersion.NugetVersion)'
  displayName: 'Build AzureMapsControl.Component v$(GitVersion.NugetVersion)'

- script: dotnet pack ./src/AzureMapsControl.Components/AzureMapsControl.Components.csproj -c Release --no-build -o '$(build.artifactStagingDirectory)'
  displayName: 'Pack AzureMapsControl.Component v$(GitVersion.NugetVersion)'