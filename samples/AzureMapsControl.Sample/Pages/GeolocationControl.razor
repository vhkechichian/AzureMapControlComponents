@page "/GeolocationControl"
@inject AzureMapsControl.Components.Geolocation.IGeolocationService GeolocationService

@using AzureMapsControl.Components.Map
<AzureMap Id="map"
          EventActivationFlags="MapEventActivationFlags
                                .None()
                                .Enable(MapEventType.Ready, MapEventType.Click)"
          OnReady="OnMapReady"
          OnClick="OnMapClick" />

@code  {

    public async Task OnMapReady(MapEventArgs eventArgs)
    {
        if (await GeolocationService.IsGeolocationSupportedAsync())
        {
            var control = new Components.Controls.GeolocationControl(position: Components.Controls.ControlPosition.TopRight);
            await eventArgs.Map.AddControlsAsync(control);
            await control.SetOptionsAsync(options => options.Style = Components.Controls.ControlStyle.Auto);
        }
    }

    public async Task OnMapClick(MapMouseEventArgs eventArgs)
    {
        var control = eventArgs.Map.Controls.OfType<Components.Controls.GeolocationControl>().FirstOrDefault();
        if (control is not null)
        {
            var feature = await control.GetLastKnownPositionAsync();
            Console.WriteLine(feature.Geometry.Coordinates.Longitude);
            Console.WriteLine(feature.Geometry.Coordinates.Latitude);
            await control.DisposeAsync();
        }
    }

}